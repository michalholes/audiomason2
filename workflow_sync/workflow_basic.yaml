# AudioMason Basic Wizard Workflow Configuration
# Definuje kroky, poradie a podmienky pre zobrazenie

workflow:
  name: "Basic Import"
  description: "Standard audiobook import workflow"
  
  # Preflight steps (otazky pred spracovanim)
  preflight_steps:
    # Krok 1: Vyber zdroja (vzdy sa zobrazi)
    - id: choose_source
      type: menu
      enabled: true
      prompt: "Choose source number, or 'a' for all"
      default: "1"
    
    # Krok 2: Clean inbox otazka
    - id: clean_inbox
      type: yes_no
      enabled: true
      prompt: "Clean inbox after successful import"
      default: no
      # Ak je v config/CLI nastavene, preskoci otazku
      skip_if_set: true
    
    # Krok 3: Publish otazka
    - id: publish
      type: yes_no
      enabled: true
      prompt: "Publish after import"
      default: no
      skip_if_set: true
    
    # Krok 4: Wipe ID3 otazka
    - id: wipe_id3
      type: yes_no
      enabled: true
      prompt: "Full wipe ID3 tags before tagging"
      default: no
      skip_if_set: true
    
    # Krok 5: Clean stage otazka
    - id: clean_stage
      type: yes_no
      enabled: true
      prompt: "Clean stage after successful import"
      default: yes
      skip_if_set: true
    
    # Krok 6: Author prompt
    - id: author
      type: input
      enabled: true
      prompt: "Author name"
      required: true
      # Hint z nazvu adresara (pred " - ")
      hint_from: source_name
      hint_pattern: "^([^-]+)"
    
    # Krok 7: Title prompt
    - id: title
      type: input
      enabled: true
      prompt: "Book title"
      required: true
      # Hint z nazvu adresara (po " - ")
      hint_from: source_name
      hint_pattern: " - (.+?)(?:\\s*\\(\\d{4}\\))?(?:\\s*\\([A-Z]{2}\\))?$"
  
  # Processing steps (samotne spracovanie)
  processing_steps:
    # Krok 1: Import do stage
    - id: import
      plugin: file_io_sync
      method: import_to_stage
      enabled: true
      description: "Import to staging area"
    
    # Krok 2: Detekcia cover
    - id: detect_cover
      plugin: cover_handler_sync
      method: process
      enabled: true
      description: "Detect cover art"
    
    # Krok 3: Fetch metadata (volitelne)
    - id: fetch_metadata
      plugin: metadata_sync
      method: process
      enabled: false  # Vypnute defaultne
      description: "Fetch metadata from online sources"
      # Zapne sa len ak je v config fetch_metadata: true
      condition: "config.fetch_metadata == true"
    
    # Krok 4: Audio processing
    - id: audio_process
      plugin: audio_processor_sync
      method: process_files
      enabled: true
      description: "Process audio files"
    
    # Krok 5: ID3 tagging
    - id: id3_tag
      plugin: id3_tagger_sync
      method: tag_files
      enabled: true
      description: "Apply ID3 tags"
    
    # Krok 6: Export (len ak publish=yes)
    - id: export
      plugin: file_io_sync
      method: export_to_output
      enabled: true
      description: "Export to output directory"
      condition: "answers.publish == true"
    
    # Krok 7: Cleanup stage (len ak clean_stage=yes)
    - id: cleanup_stage
      plugin: file_io_sync
      method: cleanup_stage
      enabled: true
      description: "Clean staging directory"
      condition: "answers.clean_stage == true"
    
    # Krok 8: Cleanup inbox (len ak clean_inbox=yes)
    - id: cleanup_inbox
      plugin: file_io_sync
      method: cleanup_inbox
      enabled: true
      description: "Clean inbox source"
      condition: "answers.clean_inbox == true"

# Verbosity settings - co sa zobrazuje pri kazdom leveli
verbosity:
  quiet:  # Level 0
    - errors
  
  normal:  # Level 1
    - errors
    - prompts
    - progress
    - workflow_steps
  
  verbose:  # Level 2
    - errors
    - prompts
    - progress
    - workflow_steps
    - plugin_calls
    - file_operations
  
  debug:  # Level 3
    - errors
    - prompts
    - progress
    - workflow_steps
    - plugin_calls
    - file_operations
    - config_values
    - ffmpeg_output
    - api_responses
