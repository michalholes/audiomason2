verbosity = "verbose" # debug | verbose | normal | quiet
console_color = "auto" # auto | always | never


[paths]
# Canonical (optional; runner may infer)
# repo_root = "/home/pi/audiomason2"
# patch_dir = "/home/pi/audiomason2/patches"

# Canonical (supported by runner; missing in your file)
# success_archive_name = "{repo}-{branch}.zip"


[git]
allow_push_fail = true
default_branch = "main"

# NOTE: present in your file; in the runner policy this is ignored (fetch behavior is unconditional).
fetch_always = true

require_up_to_date = true

# Canonical (supported by runner; missing in your file)
enforce_main_branch = true


[workspace]
# NOTE: present in your file; not part of runner Policy surface (keep only if used elsewhere).
enabled = true
# NOTE: present in your file; not part of runner Policy surface (keep only if used elsewhere).
base = "local_head"

# Legacy alias (runner maps delete_on_success -> delete_workspace_on_success)
delete_on_success = true
# Canonical (supported by runner; missing in your file)
delete_workspace_on_success = true

# Canonical (supported by runner; missing in your file)
update_workspace = false
# Canonical (supported by runner; missing in your file)
soft_reset_workspace = false

# Canonical (supported by runner; missing in your file)
test_mode = false
# Canonical (supported by runner; missing in your file)
test_mode_isolate_patch_dir = true


[scope]
allow_outside_files = false
declared_untouched_fail = true
allow_declared_untouched = false

# Legacy alias (runner maps enforce_files_only -> enforce_allowed_files)
enforce_files_only = true
# Canonical (supported by runner; missing in your file)
enforce_allowed_files = true

no_op_fail = true

# Canonical (supported by runner; missing in your file)
allow_no_op = false


[gates]
# Legacy alias (runner maps order -> gates_order)
# order = []
# order = ["pytest"]
order = ["compile", "ruff", "pytest", "mypy", "docs"]
# Canonical (supported by runner; missing in your file)
gates_order = ["compile", "ruff", "pytest", "mypy", "docs"]

# Canonical (supported by runner; missing in your file)
run_all_tests = true

compile_check = true

# Canonical (supported by runner; missing in your file)
compile_targets = ["."]
compile_exclude = ["patches"]

ruff_autofix = true
# Canonical (supported by runner; missing in your file)
ruff_autofix_legalize_outside = false
ruff_format = true

pytest_use_venv = true

# Canonical (supported by runner; missing in your file)
gates_allow_fail = false
gates_on_partial_apply = true
gates_on_zero_apply = false

gates_skip_ruff = false
# Canonical (supported by runner; missing in your file)
gates_skip_pytest = false
gates_skip_mypy = false

# Documentation gate (docs) - required updates when watched paths change
gates_skip_docs = false
gate_docs_include = ["src", "plugins"]
gate_docs_exclude = ["badguys", "patches"]
gate_docs_required_files = ["docs/changes.md", "docs/specification.md"]

gate_badguys_runner = "off"
gate_badguys_command = ["badguys/badguys.py", "-q", "--exclude=test_900_commit_push_timestamp"]
gate_badguys_cwd = "auto"


[promotion]
# NOTE: present in your file; not part of runner Policy surface (keep only if used elsewhere).
mode = "copy_files"

fail_if_live_files_changed = true
live_changed_resolution = "fail"
commit_and_push = true

# Legacy alias (runner maps rollback_on_failure -> no_rollback by inversion)
rollback_on_failure = true
# Canonical (supported by runner; missing in your file)
no_rollback = false


[logging]
# NOTE: present in your file; not part of runner Policy surface (keep only if used elsewhere).
log_retention = 20


[security]
ascii_only_patch = true

# NOTE: present in your file; not part of runner Policy surface (keep only if used elsewhere).
block_subprocess_network_best_effort = true

patch_jail = true
patch_jail_unshare_net = true
live_repo_guard = true
live_repo_guard_scope = "patch"
rollback_workspace_on_fail = true

# Canonical (supported by runner; missing in your file)
skip_up_to_date = false
# Canonical (supported by runner; missing in your file)
allow_non_main = false


# Gate targets
ruff_targets = ["src", "plugins", "scripts", "tests"]
pytest_targets = ["tests"]
mypy_targets = ["src", "plugins", "scripts"]


[audit]
# If true, fail fast when new audit domains are added without updating audit/audit_rubric.yaml
# with required runtime evidence commands.
post_success_audit = false
audit_rubric_guard = false



# --- Phase 2: runner layout/path settings (defaults shown) ---
patch_dir_name = "patches"
patch_layout_logs_dir = "logs"
patch_layout_workspaces_dir = "workspaces"
patch_layout_successful_dir = "successful"
patch_layout_unsuccessful_dir = "unsuccessful"
lockfile_name = "am_patch.lock"
current_log_symlink_name = "am_patch.log"
current_log_symlink_enabled = true
log_ts_format = "%Y%m%d_%H%M%S"
# log_template_issue = "am_patch_issue_{issue}_{ts}.log"
# log_template_finalize = "am_patch_finalize_{ts}.log"
# failure_zip_name = "patched.zip"
# failure_zip_log_dir = "logs"
# failure_zip_patch_dir = "patches"
# workspace_issue_dir_template = "issue_{issue}"
# workspace_repo_dir_name = "repo"
# workspace_meta_filename = "meta.json"
# workspace_history_logs_dir = "logs"
# workspace_history_oldlogs_dir = "oldlogs"
# workspace_history_patches_dir = "patches"
# workspace_history_oldpatches_dir = "oldpatches"
# blessed_gate_outputs = ["audit/results/pytest_junit.xml"]
# scope_ignore_prefixes = [".am_patch/", ".pytest_cache/", ".mypy_cache/", ".ruff_cache/", "__pycache__/"]
# scope_ignore_suffixes = [".pyc"]
# scope_ignore_contains = ["/__pycache__/"]
venv_bootstrap_mode = "auto"  # auto|always|never

venv_bootstrap_python = ".venv/bin/python"
