[server]
host = "0.0.0.0"
port = 8099

[meta]
version = "1.2.4"

[runner]
command = ["python3", "scripts/am_patch.py"]
default_verbosity = "normal"
queue_enabled = true
runner_config_toml = "scripts/am_patch/am_patch.toml"

[paths]
patches_root = "patches"
upload_dir = "patches/incoming"
allow_crud = true
crud_allowlist = ["", "incoming", "artifacts", "logs", "successful", "unsuccessful"]

[upload]
max_bytes = 200000000
allowed_extensions = [".zip", ".patch", ".diff", ".py"]
ascii_only_names = true

[issue]
default_regex = "issue_(\\d+)"
allocation_start = 1
allocation_max = 99999

[indexing]
log_filename_regex = "am_patch_issue_(\\d+)_"
stats_windows_days = [7, 30]

[ui]
base_font_px = 24
drop_overlay_enabled = true

[autofill]
enabled = true
poll_interval_seconds = 10

# Filesystem scan (non-recursive)
scan_dir = "patches"
scan_extensions = [".zip", ".patch", ".diff", ".py"]
# If true, ignore .zip candidates that do not contain any .patch file entry.
scan_zip_require_patch = false
scan_ignore_filenames = []
scan_ignore_prefixes = []
choose_strategy = "mtime_ns"
tiebreaker = "lex_name"

# Derivation
derive_enabled = true
issue_regex = "^issue_(\\d+)_"
commit_regex = "^issue_\\d+_(.+)\\.(zip|patch|diff|py)$"
commit_replace_underscores = true
commit_replace_dashes = true
commit_collapse_spaces = true
commit_trim = true
commit_ascii_only = true
issue_default_if_no_match = ""
commit_default_if_no_match = ""

# UI fill policy
overwrite_policy = "if_not_dirty"
fill_patch_path = true
fill_issue_id = true
fill_commit_message = true

# Zip commit message (optional; fallback to filename derivation)
zip_commit_enabled = true
zip_commit_filename = "COMMIT_MESSAGE.txt"
zip_commit_max_bytes = 4096
zip_commit_max_ratio = 200
